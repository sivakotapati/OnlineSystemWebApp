<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online LPK12 Course</title>
    <!-- BootStrap 5 CDN Link -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<script type="text/javascript" src="../static/global.js"></script>
    <!-- Custom CSS link -->
    <link rel="stylesheet" href="style.css">
    <style>
		.disabled-link{ 
			pointer-events: none;
			cursor: not-allowed;
		}
			 .scrollableDiv{
	 		height: 600px;
	 		overflow-y:auto;
	 		overflow-x:hidden;
	 		padding-top: 10px;
	 		padding-bottom: 10px;
	 }
	 
	 .disabled{
	 	display: none;
	 }
	</style>
</head>
<body>

    <section class="wrapper">
        <div class="row container">
            <div class="col-4" style="margin-top: 10rem;">
                <img src="../images/education.png" class="img-fluid"/>
            </div>
            <div class="col-sm-8 offset-sm-2 col-lg-6 offset-lg-3 col-xl-4 offset-xl-4 text-center ms-auto scrollableDiv" style="margin-top: 5rem; height:auto;">
                 	  <form class="rounded bg-white shadow p-5" id="form" method="post" >
                 	  <h3 class="text-dark fw-bolder fs-4 mb-2">Forgot Password?</h3>
					<div class="text-dark fw-bolder fs-4 mb-2">
					    <h4 id="userName" style="color: black ">Hi Username</h4>
					  </div>
					
<br>
                    
                    
		<div class="form-floating">
 	    	<input type="password" class="form-control" id="newPassword" placeholder="New Password">
	 	    <label for="newPassword">New Password</label><br>    
	</div>
	<br>
	
	<div class="form-floating">
 	    	<input type="password" class="form-control" id="newPassword" placeholder="Confirm Password">
	 	    <label for="confirmPassword">Confirm Password</label><br>    
	</div>
          
 <br>
 <div>
 <button type="button" class="btn btn-primary" style="min-width : 250px" >Change Password</button>
            </div>
            <br>
            </form>
            </div>
        </div>
    </section>
</body>
 <script type="text/javascript">
 var form=document.getElementById('form');
 document.getElementById("generateOTP").addEventListener("click", displayMethod);
 function displayMethod(){
	 var x = document.getElementById("clickDisabled");
	 x.classList.remove("disabled");
	 const generateAPI = dotnet_endpoint+"api/User/SendOTP";
	   fetch(generateAPI,{
		     method:'POST',
		     body: JSON.stringify({
		         "username":userName
		     }),
		     headers:{
		       'Content-Type':'application/json; charset=UTF-8',
		       'Authorization': "Bearer "+ sessionStorage.getItem("token")
		     }
		   }).then(function(response){
		     var resp=response.json();
		     console.log(resp)
		     if(response){
		         
		     }
		     else{
		         
		     }
		 }).then(function(data){
		 });
 	console.log("asdasdas");
 }
 form.addEventListener('submit',function(e){
   e.preventDefault()
   var userName=document.getElementById('userName').value;
   var newPassword=document.getElementById('newPassword').value;
   var enterOTP=document.getElementById('enterOTP').value;
   // Password validation
    var passwordValidation = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
   if (!passwordValidation.test(newPassword)) {
       alert("Password must contain at least 8 characters,  one uppercase letter, one lowercase letter, one numeric , and one special character");
       return;
   } 
   //fetch post request
   //const corsProxy = "https://onlinelpk12-corsproxy.herokuapp.com/";
   const forgotPasswordAPI = dotnet_endpoint+"api/User/ForgotPassword";
   fetch(forgotPasswordAPI,{
     method:'POST',
     body: JSON.stringify({
         "username":userName,
         "password":newPassword
     }),
     headers:{
       'Content-Type':'application/json; charset=UTF-8',
       'Authorization': "Bearer "+ sessionStorage.getItem("token")
     }
   }).then(function(response){
     var resp=response.json();
     console.log(resp)
     if(response.status==200){
         resp.then((data)=>{
             location.href='login.html'
           	
         })
     }
     else{
         if(response.status==404){
             resp.then((data)=>{
                 alert(data.message)
                 location.href='forgotPassword.jsp'
             })
         }
         else if (response.status=401){
         	resp.then((data)=>{
         		alert(data.errors)
         		location.href='forgotPassword.jsp'
         	})
         }
     }
 }).then(function(data){
 });
})
</script>
</html>