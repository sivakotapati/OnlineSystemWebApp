<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online LPK12 Course</title>
    <!-- BootStrap 5 CDN Link -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<script type="text/javascript" src="../static/global.js"></script>
    <!-- Custom CSS link -->

    
    <style>
		.disabled-link{ 
			pointer-events: none;
			cursor: not-allowed;
		}
			 .scrollableDiv{
	 		height: 600px;
	 		overflow-y:auto;
	 		overflow-x:hidden;
	 		padding-top: 10px;
	 		padding-bottom: 10px;
	 }
	 
	 .disabled{
	 	display: none;
	 }
	</style>
</head>
<body>

    <section class="wrapper">
        <div class="row container">
            <div class="col-4" style="margin-top: 10rem;">
                <img src="../images/education.png" class="img-fluid"/>
            </div>
            <div class="col-sm-8 offset-sm-2 col-lg-6 offset-lg-3 col-xl-4 offset-xl-4 text-center ms-auto scrollableDiv" style="margin-top: 5rem; height:auto;">
                 	  <form class="rounded bg-white shadow p-5" id="form" method="post" >
                 	  <h3 class="text-dark fw-bolder fs-4 mb-2">Forgot Password?</h3>
                 	  <div class="fw-normal text-muted mb-4">
                        We can help you out!
                    </div>
                    
                    <!-- emailId label and placeholder -->
                    
        <div class="form-floating">
	 	    <input type="email" id="email" class="form-control" placeholder="emailID">
            <label for="email">Email ID</label> 
            <!-- <label for="userName">UserName</label>
	    <input type="text"  name="user" placeholder="userName" id="userName" required> -->
		</div>
		
	<br>
	<button id="generateOTP" type="button" class="btn btn-warning" style= "float: left" >Generate OTP</button>
	<br><br>
	<div class="form-floating">
	    	<input type="password" class="form-control" id="newPassword" placeholder="New Password">
	 	    <label for="newPassword" style="float : left" >Enter OTP</label>
		</div> 
	
 	    <!-- <div class="form-floating">
 	    	<input type="password" class="form-control" id="newPassword" placeholder="Confirm Password">
            <label for="confirmPassword">Confirm Password</label>
	 	    <label for="confirmPassword">Confirm Password</label><br>
		    <input type="Password" placeholder="Confirm Password" id="newPassword" required>
	    </div> -->
	    
	    
<!--  	    <br>
 --> 	   		<!-- <button type="submit" class="btn btn-primary submit_btn w-100 my-4">Login</button> -->

 	    
	    <!-- <br>
	    	<div class="form-floating">
	    	<input type="Password" class="form-control" placeholder="Enter your OTP" id="newPassword" required>
	 	    <label for="enterOTP">Enter your OTP</label>		    
	    </div>
 	    <br> -->

<!--             <input class="btn btn-primary submit_btn w-100 my-4" type="submit"  value="Change Password" >  <br>

 -->            
 <br>
 			 <div>
			 <button type="button" class="btn btn-primary" style="min-width : 250px" >Verify OTP</button>
            </div>
            <br>
            <br><a href="login.html">Return to Login</a>  <br>
 </form>

            </div>
        </div>
    </section>
<!-- </body>
 <script type="text/javascript">
 var form=document.getElementById('form');
 document.getElementById("generateOTP").addEventListener("click", displayMethod);
 function displayMethod(){
	 var x = document.getElementById("clickDisabled");
	 x.classList.remove("disabled");
	 const generateAPI = dotnet_endpoint+"api/User/SendOTP";
	   fetch(generateAPI,{
		     method:'GET',
		     
		     headers:{
		       'Content-Type':'application/json; charset=UTF-8',
		
		     }
		   }).then(function(response){
		     var resp=response.json();
		     console.log(resp)
		     if(response){
		         
		     }
		     else{
		         
		     }
		 }).then(function(data){
		 });
 	console.log("asdasdas");
 }
 form.addEventListener('submit',function(e){
   e.preventDefault()
   var userName=document.getElementById('userName').value;
  // var newPassword=document.getElementById('newPassword').value;
   var enterOTP=document.getElementById('enterOTP').value;
   // Password validation
    var passwordValidation = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
   if (!passwordValidation.test(newPassword)) {
       alert("Password must contain at least 8 characters,  one uppercase letter, one lowercase letter, one numeric , and one special character");
       return;
   } 
   //fetch post request
   const corsProxy = "https://onlinelpk12-corsproxy.herokuapp.com/";
   const forgotPasswordAPI = dotnet_endpoint+"api/User/SendOTP";
   fetch(forgotPasswordAPI,{
     method:'POST',
     body: JSON.stringify({
         "username":userName,
         "password":newPassword
     }),
     headers:{
       'Content-Type':'application/json; charset=UTF-8',
       'Authorization': "Bearer "+ sessionStorage.getItem("token")
     }
   }).then(function(response){
     var resp=response.json();
     console.log(resp)
     if(response.status==200){
         resp.then((data)=>{
            sessionStorage.setItem("username",data.content.username)
            sessionStorage.setItem("userId",data.content.id)
     		sessionStorage.setItem("token",data.content.accessToken)
            console.log(sessionStorage.getItem("userId"))	
             })
     }
     else{
         if(response.status==404){
             resp.then((data)=>{
                 alert(data.message)
                 location.href='forgotPassword.jsp'
             })
         }
         else if (response.status=401){
         	resp.then((data)=>{
         		alert(data.errors)
         		location.href='forgotPassword.jsp'
         	})
         }
     }
 }).then(function(data){
 });
  -->
   
   <script type="text/javascript">
    document.getElementById("generateOTP").addEventListener("click", function () {
        var userName = document.getElementById("userName").value;
        fetch('https://localhost:7155/api/User/SendOTP?userName='+userName, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => {
            console.log(response.status);
        	if (!response.ok) {
                throw new Error('Failed to send OTP');
            }
            alert("OTP is sent to your email.");
        })
        .catch((error) => {
            console.error('Error:', error);
            alert('User is invalid or failed to send OTP. Please try again later.');
        });
    });
   
</script>
   

</body>
</html>